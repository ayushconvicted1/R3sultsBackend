generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MEMBER
  GUEST
}

enum Gender {
  male
  female
  other
}

enum AuthProvider {
  phone
  google
  apple
  email
}

enum MemberRelation {
  Father
  Mother
  Wife
  Husband
  Son
  Daughter
  Brother
  Sister
  Grandfather
  Grandmother
  Uncle
  Aunt
  Cousin
  Friend
  Other
}

enum Permission {
  USERS_VIEW
  USERS_CREATE
  USERS_UPDATE
  USERS_DELETE
  USERS_ACTIVATE
  USERS_DEACTIVATE
  PROFILE_VIEW
  PROFILE_UPDATE_OWN
  PROFILE_UPDATE_OTHERS
  FAMILY_VIEW
  FAMILY_ADD_MEMBER
  FAMILY_REMOVE_MEMBER
  FAMILY_UPDATE_MEMBER
  FAMILY_UPDATE_GROUP
  MEDICAL_VIEW
  MEDICAL_UPDATE_OWN
  MEDICAL_UPDATE_OTHERS
  SETTINGS_VIEW
  SETTINGS_UPDATE
  REPORTS_VIEW
  REPORTS_EXPORT
}

enum VolunteerStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum VendorStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

model User {
  id                     String        @id @default(cuid())
  phoneNumber            String?       @unique
  email                  String?       @unique
  username               String?       @unique
  passwordHash           String?
  fullName               String?
  dateOfBirth            DateTime?
  gender                 Gender?
  profilePictureUrl      String?
  address                String?
  city                   String?
  state                  String?
  country                String        @default("India")
  pincode                String?
  emergencyContactName   String?
  emergencyContactPhone  String?
  bloodGroup             String?
  medicalConditions      String?
  authProvider           AuthProvider  @default(phone)
  providerId             String?
  otpCode                String?
  otpExpiresAt           DateTime?
  otpAttempts            Int           @default(0)
  refreshToken           String?
  isVerified             Boolean       @default(false)
  isActive               Boolean       @default(true)
  emailVerified          Boolean       @default(false)
  phoneVerified          Boolean       @default(false)
  planLimit              Int           @default(2)
  isSubscriber           Boolean       @default(false)
  role                   UserRole      @default(MEMBER)
  roleAssignedBy         String?
  roleAssignedAt         DateTime?
  lastLoginAt            DateTime?
  deletedAt              DateTime?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  locationSharingEnabled  Boolean      @default(false)
  locationTrackingEnabled Boolean      @default(false)
  locationUpdateInterval  Int          @default(60)
  propertyAddress        String?
  propertyDescription    String?
  planId                 String?       @default("basic")
  stripeCustomerId       String?
  subscriptionEndsAt     DateTime?
  subscriptionId         String?

  groups               Group[]           @relation("GroupAdmin")
  members              Member[]          @relation("MemberUser")
  geofences            Geofence[]
  geofenceEvents       GeofenceEvent[]
  locationHistory      LocationHistory[]
  locationSharingFrom  LocationSharing[] @relation("SharingFrom")
  locationSharingTo    LocationSharing[] @relation("SharingTo")
  userLocation         UserLocation?
  propertyPhotos       PropertyPhoto[]

  @@index([phoneNumber])
  @@index([email])
  @@index([authProvider, providerId])
  @@index([planId])
  @@map("users")
}

model Vendor {
  id                    String        @id @default(cuid())
  phoneNumber           String?       @unique
  email                 String?       @unique
  username              String?       @unique
  passwordHash          String?
  fullName              String
  businessName          String?
  dateOfBirth           DateTime?
  gender                Gender?
  profilePictureUrl     String?
  businessType          String?
  businessCategory      String?
  einNumber             String?       @unique
  ssnNumber             String?
  licenseNumber         String?
  registrationNumber    String?
  address               String?
  city                  String?
  state                 String?
  country               String        @default("USA")
  zipCode               String?
  alternatePhone        String?
  emergencyContactName  String?
  emergencyContactPhone String?
  website               String?
  einDocumentUrl        String?
  ssnDocumentUrl        String?
  licenseDocumentUrl    String?
  addressProofUrl       String?
  bankDetailsUrl        String?
  authProvider          AuthProvider  @default(phone)
  providerId            String?
  otpCode               String?
  otpExpiresAt          DateTime?
  otpAttempts           Int           @default(0)
  refreshToken          String?
  isVerified            Boolean       @default(false)
  isActive              Boolean       @default(true)
  emailVerified         Boolean       @default(false)
  phoneVerified         Boolean       @default(false)
  status                VendorStatus  @default(PENDING)
  verifiedBy            String?
  verifiedAt            DateTime?
  rejectionReason       String?
  notes                 String?
  rating                Float?        @default(0)
  totalOrders           Int           @default(0)
  lastLoginAt           DateTime?
  deletedAt             DateTime?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt

  @@index([phoneNumber])
  @@index([email])
  @@index([einNumber])
  @@index([status])
  @@index([authProvider, providerId])
  @@map("vendors")
}

model Volunteer {
  id                    String          @id @default(cuid())
  phoneNumber           String?         @unique
  email                 String?         @unique
  username              String?         @unique
  passwordHash          String?
  fullName              String
  dateOfBirth           DateTime?
  gender                Gender?
  profilePictureUrl     String?
  address               String?
  city                  String?
  state                 String?
  country               String          @default("India")
  pincode               String?
  alternatePhone        String?
  emergencyContactName  String?
  emergencyContactPhone String?
  skills                String?
  experience            String?
  availability          String?
  languages             String?
  volunteerType         String?
  idProofUrl            String?
  addressProofUrl       String?
  backgroundCheckUrl    String?
  authProvider          AuthProvider    @default(phone)
  providerId            String?
  otpCode               String?
  otpExpiresAt          DateTime?
  otpAttempts           Int             @default(0)
  refreshToken          String?
  isVerified            Boolean         @default(false)
  isActive              Boolean         @default(true)
  emailVerified         Boolean         @default(false)
  phoneVerified         Boolean         @default(false)
  status                VolunteerStatus @default(PENDING)
  verifiedBy            String?
  verifiedAt            DateTime?
  rejectionReason       String?
  notes                 String?
  lastLoginAt           DateTime?
  deletedAt             DateTime?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  @@index([phoneNumber])
  @@index([email])
  @@index([status])
  @@index([authProvider, providerId])
  @@map("volunteers")
}

model Group {
  id        String   @id @default(cuid())
  name      String?
  adminId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  admin   User     @relation("GroupAdmin", fields: [adminId], references: [id])
  members Member[]

  @@index([adminId])
  @@map("groups")
}

model Member {
  id       String         @id @default(cuid())
  userId   String
  adminId  String
  groupId  String
  relation MemberRelation
  isActive Boolean        @default(true)
  joinedAt DateTime       @default(now())

  user  User  @relation("MemberUser", fields: [userId], references: [id])
  group Group @relation(fields: [groupId], references: [id])

  @@index([userId])
  @@index([adminId])
  @@index([groupId])
  @@map("members")
}

model Geofence {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  centerLat   Float
  centerLng   Float
  radius      Float
  polygon     Json?
  type        String   @default("circle")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user   User            @relation(fields: [userId], references: [id])
  events GeofenceEvent[]

  @@index([userId])
  @@index([centerLat, centerLng])
  @@map("geofences")
}

model GeofenceEvent {
  id         String   @id @default(cuid())
  geofenceId String
  userId     String
  eventType  String
  latitude   Float
  longitude  Float
  timestamp  DateTime @default(now())

  geofence Geofence @relation(fields: [geofenceId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@index([geofenceId])
  @@index([userId])
  @@index([timestamp])
  @@map("geofence_events")
}

model LocationHistory {
  id        String   @id @default(cuid())
  userId    String
  latitude  Float
  longitude Float
  accuracy  Float?
  altitude  Float?
  speed     Float?
  heading   Float?
  address   String?
  timestamp DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId, timestamp])
  @@index([timestamp])
  @@map("location_history")
}

model LocationSharing {
  id           String    @id @default(cuid())
  userId       String
  sharedWithId String
  isActive     Boolean   @default(true)
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())

  user       User @relation("SharingFrom", fields: [userId], references: [id])
  sharedWith User @relation("SharingTo", fields: [sharedWithId], references: [id])

  @@unique([userId, sharedWithId])
  @@index([userId])
  @@index([sharedWithId])
  @@map("location_sharing")
}

model UserLocation {
  id            String   @id @default(cuid())
  userId        String   @unique
  latitude      Float
  longitude     Float
  accuracy      Float?
  altitude      Float?
  speed         Float?
  heading       Float?
  address       String?
  city          String?
  state         String?
  country       String?
  isActive      Boolean  @default(true)
  lastUpdatedAt DateTime @default(now())
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([latitude, longitude])
  @@map("user_locations")
}

model Plan {
  id            String   @id @default(cuid())
  name          String
  memberLimit   Int
  priceCents    Int      @default(0)
  interval      String   @default("monthly")
  stripePriceId String?
  features      String?
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("plans")
}

model PropertyPhoto {
  id         String   @id @default(cuid())
  userId     String
  url        String
  type       String
  label      String?
  uploadedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  publicId   String?

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([userId, type])
  @@map("property_photos")
}

model RolePermission {
  id         String     @id @default(cuid())
  role       UserRole
  permission Permission
  createdAt  DateTime   @default(now())

  @@unique([role, permission])
  @@index([role])
  @@map("role_permissions")
}

model AccessibilitySetting {
  id           String   @id @default(cuid())
  role         UserRole
  feature      String
  canAccess    Boolean  @default(true)
  canCreate    Boolean  @default(false)
  canUpdate    Boolean  @default(false)
  canDelete    Boolean  @default(false)
  canExport    Boolean  @default(false)
  restrictions Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([role, feature])
  @@index([role])
  @@map("accessibility_settings")
}

model DashboardVolunteer {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  volunteer_id          String    @unique
  first_name            String?   @default("")
  last_name             String?   @default("")
  name                  String?   @default("")
  email                 String
  phone                 String?   @default("")
  password_hash         String?   @default("")
  date_of_birth         DateTime? @db.Timestamptz
  gender                String?
  blood_group           String?
  profile_image         String?   @default("")
  address               Json?     @default("{\"city\": \"\", \"state\": \"\", \"street\": \"\", \"country\": \"United States\", \"zipCode\": \"\"}")
  skills                Json?     @default("[]")
  specializations       Json?     @default("[]")
  languages             Json?     @default("[]")
  experience            Json?     @default("{\"years\": 0, \"description\": \"\"}")
  availability          String?   @default("available")
  availability_schedule Json?     @default("{\"nights\": false, \"weekdays\": true, \"weekends\": true, \"preferredShift\": \"any\"}")
  preferred_work_areas  Json?     @default("[]")
  willing_to_travel     Boolean?  @default(true)
  max_travel_distance   Int?      @default(50)
  assigned_disasters    Json?     @default("[]")
  completed_missions    Int?      @default(0)
  total_hours_served    Int?      @default(0)
  rating                Decimal?  @default(0)
  total_reviews         Int?      @default(0)
  emergency_contact     Json?     @default("{\"name\": \"\", \"email\": \"\", \"phone\": \"\", \"relation\": \"\"}")
  health_info           Json?     @default("{\"allergies\": [], \"physicallyFit\": true, \"medicalConditions\": []}")
  has_own_vehicle       Boolean?  @default(false)
  vehicle_type          String?   @default("none") @db.VarChar(50)
  vehicle_number        String?   @default("") @db.VarChar(100)
  status                String?   @default("active") @db.VarChar(50)
  verification_status   String?   @default("pending") @db.VarChar(50)
  admin_notes           String?   @default("")
  team_id               String?   @db.Uuid
  joined_at             DateTime? @default(now()) @db.Timestamptz
  last_active_at        DateTime? @default(now()) @db.Timestamptz
  created_at            DateTime? @default(now()) @db.Timestamptz
  updated_at            DateTime? @default(now()) @db.Timestamptz

  @@index([email], map: "idx_dashboard_volunteers_email")
  @@index([verification_status], map: "idx_dashboard_volunteers_verification_status")
  @@index([status], map: "idx_dashboard_volunteers_status")
  @@index([created_at(sort: Desc)], map: "idx_dashboard_volunteers_created_at")
  @@index([availability], map: "idx_dashboard_volunteers_availability")
  @@map("dashboard_volunteers")
}

model Disaster {
  id           String   @id
  source       String
  type         String
  title        String
  description  String   @db.Text
  instructions String?  @db.Text
  severity     String
  startTime    DateTime
  endTime      DateTime
  state        String
  areaDesc     String
  lat          Float
  lng          Float
  url          String
  raw          Json
  fetchedAt    DateTime @default(now())

  @@index([source])
  @@index([type])
  @@index([state])
  @@index([severity])
  @@index([fetchedAt])
  @@map("disasters")
}

model CacheMetadata {
  id        String   @id @default("disasters")
  lastFetch DateTime @default(now())

  @@map("cache_metadata")
}
